name: TASKS Full Auto Deployment

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
    # ì½”ë“œ ì²´í¬ì•„ì›ƒ
    - name: Checkout ì½”ë“œ
      uses: actions/checkout@v3

    # gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
    - name: gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
      run: chmod +x ./gradlew

    # ë²„ì „ ë³€ìˆ˜ ì„¤ì •
    - name: ë³€ìˆ˜ ì„¤ì • (DATE, VERSION)
      id: vars
      run: |
        echo "DATE=$(date +%Y-%m-%d)" >> $GITHUB_ENV
        echo "VERSION=v2.0" >> $GITHUB_ENV  # ğŸ”¥ ì—¬ê¸° ìˆ˜ë™ ìˆ˜ì • (ë²„ì „ëª…)

    # Slack ì•Œë¦¼ (ë¹Œë“œ ì„±ê³µ)
    - name: Slack ì•Œë¦¼ (ë¹Œë“œ ì„±ê³µ)
      if: success()
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data "{
          \"text\": \"âœ… TASKS ë¹Œë“œ ë° ë°°í¬ ì„±ê³µ!\n- ë²„ì „: ${{ env.DATE }}-${{ env.VERSION }}\n- ë¸Œëœì¹˜: ${{ github.ref_name }}\n- ì»¤ë°‹: ${{ github.event.head_commit.message }}\n- ì‘ì„±ì: ${{ github.event.head_commit.author.name }}\"
        }" ${{ secrets.SLACK_WEBHOOK_URL }}

    # Slack ì•Œë¦¼ (ë¹Œë“œ ì‹¤íŒ¨)
    - name: Slack ì•Œë¦¼ (ë¹Œë“œ ì‹¤íŒ¨)
      if: failure()
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data "{
          \"text\": \"âŒ TASKS ë¹Œë“œ ì‹¤íŒ¨!\n- ë²„ì „: ${{ env.DATE }}-${{ env.VERSION }}\n- ë¸Œëœì¹˜: ${{ github.ref_name }}\n- ì»¤ë°‹: ${{ github.event.head_commit.message }}\n- ì‘ì„±ì: ${{ github.event.head_commit.author.name }}\"
        }" ${{ secrets.SLACK_WEBHOOK_URL }}

    # GitHub íƒœê·¸ ì¶”ê°€
    - name: GitHub íƒœê·¸ ì¶”ê°€
      if: success()
      run: |
        git config user.name "github-actions"
        git config user.email "actions@github.com"
        git tag "${{ env.DATE }}-${{ env.VERSION }}"
        git push origin "${{ env.DATE }}-${{ env.VERSION }}"
